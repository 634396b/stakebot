Sorry for the messy code.
